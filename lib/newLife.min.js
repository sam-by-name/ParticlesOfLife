import{colors0,colors1}from"./colors";export const createLife=(e,o,r)=>{let l=[];for(let r=0;r<e;r++){let e=[];for(let l=0;l<o;l++)e.push({alive:0,color:colors0[0],key:[r,l],age:0,era:0,eon:0,id:0,opacity:0});l.push(e)}return r?(randomizeLife(l),l):l};const makeBlock=(e,o,r,l,t)=>{for(let a=o;a<r;a++)for(let o=l;o<t;o++)e[a][o].alive=1,e[a][o].color=colors0[1],e[a][o].age=1,e[a][o].era=8,e[a][o].eon=1;return e};export const randomizeLife=e=>{for(let o=1;o<e.length;o++)for(let r=1;r<e[0].length;r++)e[o][r].alive=Math.random()>.85?1:0,e[o][r].age=e[o][r].alive?1:0,e[o][r].color=colors0[e[o][r].age];return e};export const fade=(e,o,r)=>{for(let l=1;l<o.length;l++)for(let t=1;t<o[0].length;t++)r&&e[l][t].alive&&(o[l][t].alive=1,o[l][t].age=e[l][t].age,o[l][t].color=colors0[e[l][t].age],o[l][t].opacity=1,o[l][t].transition=`opacity ${Math.random()+.5}s ${Math.random()+.5}s`);return{lifeA:o,lifeB:e}};export const newLife=(e,o,r,l,t)=>{t=t||[],"2"===r&&t.length&&eonMove(e,t);let a=[];for(let l=0;l<e.length;l++)for(let i=0;i<e[0].length;i++)lifeOrDeath(e[l][i],o[l][i],findSur(l,i,e).reduce((e,o)=>e+o.alive,0)),ageNColor(e[l][i],o[l][i]),r&&applyRules(r,o[l][i],t,a);return"2"===r&&(a.length||t.length)&&(t.length&&(t=t.filter(e=>e.num===e.form.length)),a.length&&id(o,a),t=eonSort(a,t,o.length)),"3"===r&&borderRad(o),{lifeA:o,lifeB:e,eonPos:t,gen:l}};export const findSur=(e,o,r)=>{let l=r.length,t=r[0].length,a=e-1<0?l-1:e-1,i=e+1===l?0:e+1,n=o-1<0?t-1:o-1,f=o+1===t?0:o+1;return[r[a][n],r[a][o],r[a][f],r[e][n],r[e][f],r[i][n],r[i][o],r[i][f]]};const lifeOrDeath=(e,o,r)=>{e.alive&&(o.alive=r<2||r>3?0:1),e.alive||(o.alive=3===r?1:0)},ageNColor=(e,o)=>{o.alive?(o.opacity=1,o.transition="opacity 0s",e.age<colors0.length-1?(o.age=e.age+1,o.era=e.era):(o.age=0,o.era=e.era+1),o.era&&o.era%5==0&&!o.age?o.eon=e.eon+1:o.eon=e.eon):(o.age=0,o.era=0,o.eon=0,o.opacity=1,o.transition="opacity 0s"),o.id=o.alive?e.id:0,o.era>0?o.color=colors1[o.age]:o.color=colors0[o.age]},applyRules=(e,o,r,l)=>{if("1"===e&&o.era&&o.era%5==0&&!o.age&&(o.alive=2),"2"===e&&(o.eon>1||o.id)){let e=!1;e:for(let l=0;l<r.length;l++)for(let t=0;t<r[l].form.length;t++)if(r[l].form[t].key[0]===o.key[0]&&r[l].form[t].key[1]===o.key[1]){e=!0,r[l].form[t]={...o},r[l].num++;break e}e||l.push({...o})}},id=(e,o)=>{for(let r=0;r<o.length;r++){let[l,t]=o[r].key,a=findSur(l,t,e);for(let i=0;i<a.length;i++)if(a[i].id)e[l][t].id=a[i].id,o[r].id=a[i].id;else if(a[i].eon>0&&a[i].eon<2){let[r,l]=a[i].key;e[r][l].id=Math.floor(100*Math.random()),o.push(e[r][l]),id(e,o)}e[l][t].id||(e[l][t].id=Math.floor(100*Math.random()),o[r].id=e[l][t].id)}},eonSort=(e,o,r)=>{let l,t,a,i,n,f,h;e.length&&(e=eonDir(e,[])),o.length&&e.push(...o);for(let o=0;o<e.length;o++)for(let g=0;g<e[o].form.length;g++)[n,f]=e[o].form[g].key,h=[[l=n-1<0?r-1:n-1,t=f-1<0?r-1:f-1],[l,f],[l,i=f+1===r?0:f+1],[n,t],[n,i],[a=n+1===r?0:n+1,t],[a,f],[a,i]],e[o].form[g].dir=h[e[o].dir];return e},eonDir=(e,o)=>{e.sort((e,o)=>e.id-o.id);let r=Math.floor(7*Math.random()),l={dir:r,form:[e[0]],num:0,move:0};for(let t=1;t<e.length;t++)e[t].id===e[t-1].id?l.form.push(e[t]):(l.move=Math.round(l.form.length/2),o.push(l),l={dir:r=Math.floor(7*Math.random()),form:[e[t]],num:0,move:0});return l.move=l.form.length,o.push(l),o},eonMove=(e,o)=>{resetLast(e,o);for(let r=0;r<o.length;r++)for(let l=0;l<o[r].form.length;l++){if(o[r].move){o[r].num=0,o[r].move--;break}{let[t,a]=o[r].form[l].dir;o[r].form[l].key=[t,a],e[t][a]={...o[r].form[l]},o[r].num=0,l===o[r].form.length-1&&(o[r].move=Math.round(o[r].form.length/2))}}return e},resetLast=(e,o)=>{for(let r=0;r<o.length;r++)for(let l=0;l<o[r].form.length&&!o[r].move;l++){let[t,a]=o[r].form[l].key;e[t][a]={alive:0,color:colors0[0],key:[t,a],age:0,era:0,eon:0,id:0}}};export const borderRad=e=>{for(let o=0;o<e.length;o++)for(let r=0;r<e[o].length;r++){let l,t,a,i,n,f=findSur(o,r,e);e[o][r].alive?(l=f[3].alive||f[0].alive||f[1].alive?0:50,t=f[1].alive||f[2].alive||f[4].alive?0:50,a=f[4].alive||f[7].alive||f[6].alive?0:50,i=f[3].alive||f[5].alive||f[6].alive?0:50):(f[3].alive&&f[1].alive?(l=50)&&(n=f[3].color):l=0,f[1].alive&&f[4].alive?(t=50)&&(n=f[1].color):t=0,f[4].alive&&f[6].alive?(a=50)&&(n=f[4].color):a=0,f[3].alive&&f[6].alive?(i=50)&&(n=f[3].color):i=0),e[o][r].bG=n||!1,e[o][r].radius=`${l}% ${t}% ${a}% ${i}%`}};